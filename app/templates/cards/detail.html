{% extends "base.html" %}

{% block title %}卡牌詳情{% endblock %}

{% block content %}
<!-- Back button -->
<a href="/cards" class="flex items-center gap-1.5 font-tc text-xs text-[var(--rpg-text-secondary)] hover:text-[var(--rpg-gold)] shrink-0">
  <i data-lucide="arrow-left" class="w-4 h-4"></i>返回卡牌收藏
</a>

{% if card %}
<!-- Two column layout -->
<div class="flex flex-col gap-6 flex-1 min-h-0 overflow-y-auto lg:flex-row">
  <!-- Left: Card image (portrait 880x1280) -->
  <div class="flex justify-center shrink-0">
    <div class="w-[220px] md:w-[264px]" style="aspect-ratio: 880/1280;">
      {% set border_colors = {'copper': '#b87333', 'silver': '#c0c0c0', 'gold': '#ffd700'} %}
      {% set bc = border_colors.get(card.border_style, '#b87333') %}
      <div class="w-full h-full rounded overflow-hidden"
           style="border: 3px solid {{ bc }};
                  {% if card.border_style == 'gold' %}box-shadow: 0 0 16px 3px rgba(255,215,0,0.4);{% endif %}">
        {% if card.image_url %}
        <img src="{{ card.image_url }}" alt="卡牌" class="w-full h-full object-cover">
        {% else %}
        <img src="/static/images/placeholder/card-gold-1.png" alt="卡牌" class="w-full h-full object-cover">
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Right: Card details -->
  <div class="flex flex-col gap-4 flex-1 rounded px-5 py-4
              bg-[var(--rpg-bg-panel)] border-2 border-[var(--rpg-gold-dark)]">
    <div>
      <h1 class="font-pixel text-sm text-[var(--rpg-gold)]">
        Lv.{{ card.level_number }} 角色卡牌
      </h1>
      <p class="font-tc text-xs text-[var(--rpg-text-secondary)] mt-1">
        生成時間：{{ card.created_at.strftime('%Y-%m-%d %H:%M') if card.created_at else '--' }}
      </p>
    </div>

    <!-- Attributes from config_snapshot -->
    {% set snap = card.config_snapshot | fromjson %}
    {% if snap %}
    <div class="flex flex-col gap-2">
      <span class="font-tc text-xs font-bold text-[var(--rpg-text-secondary)]">角色屬性</span>
      {% for key, value in snap.items() %}
      <div class="flex items-center gap-2">
        <span class="font-tc text-xs text-[var(--rpg-text-secondary)] w-16">{{ key }}</span>
        <span class="font-tc text-xs font-bold text-[var(--rpg-text-primary)]">{{ value }}</span>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Border info -->
    <div class="flex items-center gap-2 mt-auto pt-4 border-t border-[var(--rpg-gold-dark)]">
      {% set border_labels = {'copper': '銅色邊框', 'silver': '銀色邊框', 'gold': '金色邊框'} %}
      <i data-lucide="{% if card.border_style == 'gold' %}crown{% else %}shield{% endif %}"
         class="w-4 h-4" style="color: {{ bc }}"></i>
      <span class="font-tc text-xs font-bold" style="color: {{ bc }}">
        {{ border_labels.get(card.border_style, '銅色邊框') }}
      </span>
    </div>
  </div>
</div>

{% else %}
<!-- Card not found -->
<div class="flex flex-col items-center gap-3 py-16 text-center">
  <p class="font-tc text-sm text-[var(--rpg-text-secondary)]">找不到此卡牌</p>
  <a href="/cards" class="font-tc text-xs text-[var(--rpg-gold)] hover:underline">返回卡牌收藏</a>
</div>
{% endif %}
{% endblock %}
